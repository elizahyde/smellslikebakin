/*!CK:1889771012!*//*1392692595,178183213*/

if (self.CavalryLogger) { CavalryLogger.start_js(["XInK+"]); }

__d("LitestandSectionNav",["Arbiter","ArbiterMixin","AsyncRequest","BrowserSupport","ContextualDialog","CSS","DOM","DOMDimensions","DOMQuery","Event","Focus","JSXDOM","Keys","KeyStatus","LitestandMessages","Parent","Rect","Run","SortableGroup","Style","SubscriptionsHandler","Vector","copyProperties","csx","cx","getElementPosition","queryThenMutateDOM","requestAnimationFrame","runAfterCSSTransition","throttle"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha,ia,ja){var ka=37,la=30,ma={COLLAPSED:0,DEFAULT:1,EXPANDED:2,EXPAND_ALL:3};function na(oa,pa){this._more=pa.more;this._moreIndex=pa.more&&parseInt(pa.more.getAttribute('data-index'),10);this._seeAll=pa.see_all;this._seeAllIndex=pa.first_see_all;this._selectedIndex=pa.selected;this._currentState=pa.collapsed?ma.COLLAPSED:ma.DEFAULT;this._originalState=this._currentState;this._showSeeAllDialog=pa.has_see_all_dialog||false;this._collapseOnDialog=pa.has_see_all_dialog&&pa.has_new_rhc;this._collapsedExtra=null;this._root=oa;this._wrap=m.find(this._root,"._3ozl");this._layoutRoot=o.find(document.body,"._li");var qa=m.scry(this._root,"._7gb");this._items={};this._itemsCount=qa.length;qa.forEach(function(ra){var sa=ra.getAttribute('data-index'),ta=ra.getAttribute('data-reorderable'),ua=ra.getAttribute('data-removable');this._items[sa]={element:ra,index:parseInt(sa,10),reorderable:ta,removable:ua};}.bind(this));this._runAfterTransition=ia(this._root);this.handler=new aa();this.handler.addSubscriptions(g.subscribe(u.EXPAND_FILTER_SWITCHER,function(){this.setState(ma.EXPANDED);}.bind(this)),g.subscribe(u.COLLAPSE_FILTER_SWITCHER,function(){this.setState(ma.COLLAPSED);}.bind(this)),g.subscribe(u.RESTORE_FILTER_SWITCHER,function(){if(this._previousState===ma.DEFAULT){this.setState(ma.DEFAULT);}else this.setState(ma.COLLAPSED);}.bind(this)),g.subscribe(u.UNLOCK_FILTER_SWITCHER,function(){this._locked=false;if(this._collapseOnDialog)this.collapse(false,true);this._onScroll();}.bind(this)),this.subscribe('state_change',this.stateChanged.bind(this)),p.listen(oa,'click',this._onClick.bind(this)));if(!pa.has_new_rhc)this.handler.addSubscriptions(p.listen(window,'scroll',ja(this._onScroll.bind(this))));if(pa.expanded)this.setState(ma.EXPANDED);x.onLeave(this.handler.release.bind(this.handler));}ca(na.prototype,h,{destroy:function(){this.handler.release();},_update:function(oa,pa,qa,ra,sa,ta){pa=-pa*ka;oa=oa*ka-1;if(this._more&&(this._currentState===ma.DEFAULT||this._collapsedExtra!==null))oa-=12;var ua=function(){z.set(this._root,'height',oa+'px');z.set(this._wrap,'margin-top',pa+'px');}.bind(this);this.inform(qa,{height:oa});if(sa!==false&&j.hasCSSTransitions()){l.addClass(this._root,'animating');this._runAfterTransition(function(){l.removeClass(this._root,'animating');this.inform(ra,{height:oa});ta&&ta();}.bind(this));ha(ua);}else{ua();this.inform(ra,{height:oa});ta&&ta();}},_onScroll:function(event){var oa=null;ga(function(){var pa=-fa(this._layoutRoot).y;if(this._currentState===ma.EXPAND_ALL){var qa=fa(this._wrap).y,ra=qa+n.getElementDimensions(this._wrap).height,sa=ba.getViewportDimensions().y,ta=sa/2;if(qa<=ta&&ra+ta>sa)return;}if(this._currentState===ma.EXPAND_ALL||(this._currentState===ma.EXPANDED&&((this._originalState===ma.DEFAULT&&pa>la)||this._originalState!==ma.DEFAULT))||(this._currentState===ma.DEFAULT&&pa>la)){oa=ma.COLLAPSED;return;}if((this._originalState===ma.DEFAULT)&&((this._currentState===ma.COLLAPSED&&pa<=la)||this._currentState===ma.EXPANDED)){oa=ma.DEFAULT;return;}if(this._collapsedExtra!==null&&pa<=la){this._resetExtra(true);return;}}.bind(this),function(){this.setState(oa);}.bind(this));},_onClick:function(event){var oa=event.getTarget();if(m.contains(this._more,oa)){this.setState(ma.EXPANDED);return;}if(m.contains(this._seeAll,oa)){this.setState(ma.EXPAND_ALL);return;}var pa=v.byClass(oa,"_7gb");pa&&this.inform('click',{item:pa});if(!pa||event.isDefaultRequested())return;var qa=parseInt(pa.getAttribute('data-index'),10);if(qa===this._selectedIndex&&this._currentState===ma.COLLAPSED){this.setState(ma.EXPANDED);event.prevent();return;}if(qa===this._selectedIndex){if(this._currentState===ma.EXPANDED&&this._previousState===ma.DEFAULT){this.setState(ma.DEFAULT);}else if(this._currentState===ma.DEFAULT){this.setState(ma.EXPANDED);}else this.setState(ma.COLLAPSED);event.prevent();return;}},updateSelected:function(oa){if(!oa)return;if(this._currentState===ma.EXPAND_ALL)this.inform('reset');l.show(oa);var pa=parseInt(oa.getAttribute('data-index'),10);this.select(pa);if(pa&&this._currentState===ma.COLLAPSED&&this._collapsedExtra===null){if(this._moreIndex)if(pa>this._moreIndex){l.hide(this._more);pa--;}pa=Math.min(pa,this._seeAllIndex);z.set(this._wrap,'margin-top',-pa*ka+'px');}if(this._collapsedExtra===pa&&this._currentState===ma.COLLAPSED){this._resetExtra(true);}else{this._resetExtra();this.setState(pa?ma.COLLAPSED:ma.DEFAULT);}this._originalState=this._currentState;},getRoot:function(){return this._root;},getItemAtIndex:function(oa){return this._items[oa];},getSelected:function(){if(!this._selected)this._selected=this.getItemAtIndex(this._selectedIndex);return this._selected;},getStates:function(){return ma;},isDefaultState:function(){return this._currentState===ma.DEFAULT;},isCollapsed:function(){return this._currentState===ma.COLLAPSED;},hasAllExpanded:function(){return this._currentState===ma.EXPAND_ALL;},previousStateWasDefault:function(){return this._previousState===ma.DEFAULT;},setState:function(oa,pa){if((!oa&&oa!==ma.COLLAPSED)||this._currentState===oa||this._locked)return;this._previousState=this._currentState;this._currentState=oa;this.inform('state_change',{animate:pa});l.conditionClass(this._root,"_3ozk",oa===ma.COLLAPSED);},stateChanged:function(oa,pa){var qa=pa.animate;switch(this._currentState){case ma.COLLAPSED:this.collapse(qa);break;case ma.DEFAULT:this.expandDefault(qa);break;case ma.EXPANDED:this.expand(qa);break;case ma.EXPAND_ALL:this.expandAll(qa);break;}},select:function(oa){var pa=this.getSelected();if(pa){var qa=pa.element;l.removeClass(qa,"_3ozj");}var ra=this.getItemAtIndex(oa);if(ra){var sa=ra.element;l.addClass(sa,"_3ozj");this._selected=ra;this._selectedIndex=oa;}},expand:function(oa,pa){this._resetExtra();this.inform('before_expand');for(var qa in this._items){var ra=this._items[qa].element,sa=this._items[qa].index,ta=(ra===this._more||(oa&&ra===this._seeAll)||(!oa&&this._seeAllIndex&&ra!==this._seeAll&&sa!==this._selectedIndex&&sa>this._seeAllIndex));l.conditionShow(ra,!ta);if(!ta)ra.tabIndex=0;}var ua=this._items[this._selectedIndex||0];if(ua)if(t.getKeyDownCode()===s.RETURN){q.set(ua.element);}else q.setWithoutOutline(ua.element);var va;if(oa){va=this._itemsCount-2;}else{va=this._seeAllIndex+1;if(this._selectedIndex>this._seeAllIndex)va+=1;}this._update(va,0,oa?'expand_all':'expand',oa?'expand_all_end':'expand_end',pa,function(){this.inform('after_expand');}.bind(this));this._enableEditing();},expandAll:function(){if(this._showSeeAllDialog){new i('/ajax/litestand/filter/chooser').setData({dom_id:m.getID(this._wrap)}).send();this._locked=true;this._currentState=ma.EXPANDED;this._feedStoreLoadingDialog=new k({context:this._wrap,position:'left'},r.div({className:"_59b-"},r.div({className:"_59b_"}))).show();}else{if(!this._seeAll)return;this.expand(true);}},expandDefault:function(oa){this._resetExtra();this._disableEditing();var pa=function(){for(var sa in this._items){var ta=this._items[sa].element,ua=this._items[sa].index;l.conditionShow(ta,!this._more||ua<=this._moreIndex);if(!this.more||ua<=this._moreIndex)ta.tabIndex=0;}}.bind(this),qa=null;if(this._previousState===ma.EXPANDED||this._previousState===ma.EXPAND_ALL){qa=pa;}else pa();var ra=this._previousState===ma.EXPANDED||this._previousState===ma.EXPAND_ALL;this._update(this._moreIndex+1,0,'expand','expand_end',oa,function(){qa&&qa();ra&&this.inform('after_collapse');}.bind(this));},collapse:function(oa,pa){this.inform('before_collapse');this._disableEditing();this._currentState=ma.COLLAPSED;var qa=function(){for(var ta in this._items){var ua=this._items[ta].element;ua.tabIndex=-1;var va=this._items[ta].index;if(va===this._selectedIndex||va===this._collapsedExtra){l.show(ua);ua.tabIndex=0;continue;}var wa;if(ua===this._more&&this._collapsedExtra!==null){wa=false;ua.tabIndex=0;}else wa=(ua===this._more&&this._selectedIndex>this._moreIndex)||(this._seeAllIndex&&va>this._seeAllIndex);l.conditionShow(ua,!wa);}this.inform('after_collapse');}.bind(this);if(pa){qa();qa=null;}var ra;if(this._seeAllIndex&&this._selectedIndex>this._seeAllIndex){ra=this._seeAllIndex;}else ra=this._selectedIndex-(this._selectedIndex>this._moreIndex?1:0);var sa=1;if(this._collapsedExtra!==null){sa+=2;if(this._collapsedExtra<this._selectedIndex)ra-=1;}this._update(sa,ra,'collapse','collapse_end',oa,qa);},_restoreMore:function(){if(!this._more)return;l.hide(this._more);m.insertAfter(this.getItemAtIndex(this._moreIndex-1).element,this._more);},_resetExtra:function(oa){if(this._collapsedExtra===null)return;var pa=this.getItemAtIndex(this._collapsedExtra).element;l.removeClass(this._root,"_54m7");l.removeClass(pa,"_54m5");l.removeClass(pa,"_54m6");if(this._collapsedExtra===0){m.prependContent(pa.parentNode,pa);this._restoreMore();}else{var qa=false;if(this._moreIndex<=this._collapsedExtra){this._restoreMore();qa=true;}m.insertAfter(this.getItemAtIndex(this._collapsedExtra-1).element,pa);qa||this._restoreMore();}this.inform('collapsed_extra',{hasExtra:false});this._collapsedExtra=null;oa&&this.collapse(false);},showAdditionalInCollapse:function(oa,pa){var qa=parseInt(oa.getAttribute('data-index'),10);if(this._currentState!==ma.COLLAPSED||this._selectedIndex===qa||this._collapsedExtra!==null)return;this.inform('collapsed_extra',{hasExtra:true});var ra=this.getItemAtIndex(qa).element;l.addClass(this._root,"_54m7");l.removeClass(ra,"_54m6");l.addClass(ra,"_54m5");m.insertAfter(this.getSelected().element,ra);if(this._more){l.show(this._more);m.insertAfter(ra,this._more);this._more.tabIndex=0;}this._collapsedExtra=qa;this.collapse(true,true);setTimeout(function(){if(this._collapsedExtra!==null)l.addClass(ra,"_54m6");}.bind(this),pa);},_disableEditing:function(){this._sortableGroup&&this._sortableGroup.destroy();var oa;for(var pa in this._items){oa=this._items[pa];if(oa.reorderable)l.hide(m.find(oa.element,"._58p7"));if(oa.removable)l.hide(m.find(oa.element,"._58p6"));}this._editListeners&&this._editListeners.release();},_enableEditing:function(){this._sortableGroup=new y().setOrderChangeHandler(this._handleOrder.bind(this)).setDroppable(this._wrap).setDropCallback(function(sa,ta){z.set(ta,'height','auto');z.set(ta,'width','auto');}).setBeforeGrabCallback(function(sa){ba.getElementDimensions(sa).setElementDimensions(sa);var ta=new w(ba.getElementPosition(this._wrap).y,0,ba.getElementPosition(this._wrap).y+ba.getElementDimensions(this._wrap).y,0);this._sortableGroup.setBoundingBox(ta);}.bind(this));this._editListeners=new aa();for(var oa in this._items){var pa=this._items[oa];if(pa.reorderable){var qa=m.find(pa.element,"._58p7");this._sortableGroup.addSortable(pa.index,pa.element,qa);this._editListeners.addSubscriptions(p.listen(pa.element,'mouseover',l.show.bind(null,qa)),p.listen(pa.element,'mouseout',l.hide.bind(null,qa)));}if(pa.removable){var ra=m.find(pa.element,"._58p6");this._editListeners.addSubscriptions(p.listen(ra,'click',this._handleRemove.bind(this,pa)),p.listen(pa.element,'mouseover',l.show.bind(null,ra)),p.listen(pa.element,'mouseout',l.hide.bind(null,ra)));}}},_handleRemove:function(oa,event){this.inform('remove',{item:oa.element});event.kill();},_handleOrder:function(){this.inform('reorder',{sortables:this._sortableGroup.getSortables()});},hideLoadingDialog:function(){this._feedStoreLoadingDialog&&this._feedStoreLoadingDialog.destroy();}});e.exports=na;});