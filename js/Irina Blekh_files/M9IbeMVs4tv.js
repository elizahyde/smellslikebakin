/*!CK:1032735968!*//*1392696168,178179357*/

if (self.CavalryLogger) { CavalryLogger.start_js(["RNRJ1"]); }

__d("EntstreamHoverSubstoryViewer",["JSXDOM","Bootloader","CSS","DataStore","DOM","Event","Parent","copyProperties","csx","cx","queryThenMutateDOM"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){var r=56,s=6,t=999;function u(x){return Math.floor((x+s)/(r+s));}function v(x){x=Math.min(x,t);var y=g.a({className:"_6kp _a87"},'+'+x,g.i({className:"_5cp7"}));i.conditionClass(y,"_a88",x>100);return y;}function w(x,y,z,aa,ba,ca){this._storyID=y;this._title=ba;this._hoverchange=ca;this._actors=z;this._viewer=x;this._substoryCount=aa;var da=m.byClass(x,"_6ns");j.set(da,'EntstreamHoverSubstoryViewer',this);this.computeShown();}w.getInstance=function(x){x=m.byClass(x,"_6ns");return x&&j.get(x,'EntstreamHoverSubstoryViewer');};n(w.prototype,{_clickedMore:function(){i.hide(this._plusNBox);var x=k.create('img',{className:"_50g2",src:'/images/loaders/indicator_blue_medium.gif'});k.insertAfter(this._plusNBox,x);h.loadModules(["EntstreamSubstoryOverlay"],function(y){new y(this._storyID,this._title);k.remove(x);i.show(this._plusNBox);}.bind(this));},computeShown:function(){var x=k.scry(this._viewer,"._31r");if(x.length<=2)return;i.addClass(this._viewer,"_a89");var y=Infinity;q(function(){x.forEach(function(z){y=Math.min(y,z.offsetHeight);});},function(){i.removeClass(this._viewer,"_a89");this._plusNBox&&k.remove(this._plusNBox);this._plusNBox=null;var z=k.scry(this._actors,"._6mg"),aa=z.length,ba=Math.min(u(y),aa),ca;if(this._storyID&&this._substoryCount>ba){ca=Math.min(ba-1,aa);this._plusNBox=v(this._substoryCount-ca);l.listen(this._plusNBox,'click',this._clickedMore.bind(this));k.appendContent(this._actors,this._plusNBox);}else ca=Math.min(ba,aa);for(var da=0,ea=z.length;da<ea;da++)i.conditionShow(z[da],da<ca);}.bind(this));},getHoverChange:function(){return this._hoverchange;}});e.exports=w;});
__d("EntstreamHoverChange",["Arbiter","AsyncRequest","CSS","DOM","Event","Parent","Run","SubscriptionsHandler","$","copyProperties","csx","cx","emptyFunction"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){function t(v,w){var x=j.scry(v,"._31o"),y=j.scry(o(w),"._31r");if(x.length!==y.length){throw new Error('Number of triggers ('+x.length+') does not'+' equal number of targets ('+y.length+').');}else if(x.length===0)return;this._targetMap={};for(var z=0,aa=x.length;z<aa;z++)this._targetMap[j.getID(x[z])]=y[z];this._selectedTrigger=x[0];this._currentItemID=j.getID(y[0]);u(y[0]);var ba=new n();ba.addSubscriptions(g.subscribe('EntstreamHoverChange/selectTrigger',function(ca,da){if(x.indexOf(da)>-1){this.select(da);return false;}}.bind(this)),k.listen(v,'mouseover',this._handleMouseOver.bind(this)));m.onLeave(ba.release.bind(ba));}function u(v){var w=v.getAttribute('data-item-uri');if(!w)return;v.removeAttribute('data-item-uri');new h(w).setHandler(function(x){j.setContent(v,x.getPayload());}).setErrorHandler(s).send();}p(t.prototype,{_handleMouseOver:function(event){var v=event.getTarget(),w=l.byClass(v,"_31o");if(!w||w===this._selectedTrigger)return;this.select(w);},addItem:function(v,w){i.addClass(v,"_31o");i.addClass(w,"_31r");this._targetMap[j.getID(v)]=w;return this;},select:function(v){i.removeClass(this._selectedTrigger,"_31p");i.addClass(v,"_31p");this._selectedTrigger=v;var w=this._targetMap[j.getID(v)];if(!w)return;i.removeClass(o(this._currentItemID),"_31q");i.addClass(w,"_31q");this._currentItemID=j.getID(w);u(w);}});e.exports=t;});