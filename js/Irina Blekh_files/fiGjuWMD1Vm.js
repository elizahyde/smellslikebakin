/*!CK:776465011!*//*1392421151,178191663*/

if (self.CavalryLogger) { CavalryLogger.start_js(["bI4ae"]); }

__d("LitestandTickerController",["JSXDOM","Animation","Arbiter","AsyncRequest","AsyncSignal","AvailableList","AvailableListConstants","Bootloader","ChannelConstants","LegacyContextualDialog","CSS","DOM","Event","HTML","Keys","LayerFadeOnHide","LitestandSidebarConfig","LiveTimer","NavigationMessage","Parent","Run","ScrollableArea","SelectorDeprecated","Style","TickerReadStateTracking","Toggler","UIPagelet","URI","UserActivity","UserAgent","Vector","$","clickRefAction","collectDataAttributes","copyProperties","csx","cx","emptyFunction","ge","goURI","throttle","userAction","TickerRHCPageletByGK"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha,ia,ja,ka,la,ma,na,oa,pa,qa,ra,sa,ta,ua,va){var wa=1,xa=2,ya=3,za=4,ab=60;function bb(){}oa(bb,{_instances:{},_activeInstance:null,_placeholders:{},_logPositionChange:false,getInstance:function(cb){var db=z.byClass(la(cb),'fbFeedTicker');return db?bb._instances[db.id]:null;},isLoaded:function(cb){var db=bb._placeholders[cb.id];return !db||db.status==ya;},show:function(cb,db){db=db||ra;for(var eb in bb._instances){var fb=sa(eb);if(!fb||fb.parentNode.id==cb.id)continue;bb.hide(fb.parentNode);}bb._doPositionChange(cb);q.show(cb);var gb=bb._placeholders[cb.id];if(gb&&gb.status==wa){bb._fetchTickerForPlaceholder(cb,db);}else{var hb=r.scry(cb,'.fbFeedTicker')[0],ib=hb&&bb.getInstance(hb);bb._activeInstance=ib;ib&&ib._poll();bb._placeholders[cb.id]={status:za,callback:db};db();}},_doPositionChange:function(cb){if(!bb._logPositionChange||q.shown(cb))return;new k('/common/ods_endpoint.php',{k:'ticker.render.switch.'+cb.id}).send();},hide:function(cb){var db=r.scry(cb,'.fbFeedTicker')[0],eb=db&&bb.getInstance(db);eb&&eb.hideActiveStory();q.hide(cb);},hideStoriesByClass:function(cb){for(var db in bb._instances)r.scry(la(db),cb).forEach(q.hide);},hideStory:function(cb){var db=cb&&bb.getInstance(cb);db&&db.hideStory(cb);},undoHideStory:function(cb){var db=cb&&bb.getInstance(cb);db&&db.undoHideStory(cb);},insertStoriesAtBottom:function(cb){bb._activeInstance.insertStoriesAtBottom(cb);},_fetchTickerForPlaceholder:function(cb,db){var eb={handler:function(){bb._placeholders[cb.id].status=ya;db();}},fb=b('TickerRHCPageletByGK'),gb=fb.pagelet_name;ga.loadFromEndpoint(gb,cb.id,bb._placeholders[cb.id].pageletData,eb);bb._placeholders[cb.id].status=xa;},registerStoryDialog:function(cb,db){i.subscribe('ticker/init',function(){var eb=sa(cb),fb=eb&&bb.getInstance(eb);fb&&fb.registerStoryDialog(eb,db);},i.SUBSCRIBE_ALL);},registerPlaceholder:function(cb,db){var eb=bb._placeholders[cb];bb._placeholders[cb]={status:wa,pageletData:db};if(eb&&eb.status==za){bb.show(la(cb));eb.callback();}}});oa(bb.prototype,{ADS_IDLE_MS:300000,FLYOUT_MAX_HEIGHT:450,FLYOUT_OFFSET_THRESHOLD:20,FLYOUT_COMMENT_OFFSET:15,FLYOUT_VIEWPORT_PADDING:75,FLYOUT_TARGET_HEIGHT_OFFSET:25,init:function(cb,db){bb._instances[cb.id]=this;bb._activeInstance=this;this._root=cb;this._wrapper=z.byClass(cb,"_4-q5");this._content=r.find(cb,'.ticker_stream');this._stories=r.find(this._root,'.tickerActivityStories');this._newestStory={};this._storyIDs=[];this._objectIDs=[];this._fetchedStories={};this._removedStoryIDs=[];this._storiesToRemove=[];var eb=Date.now();this._initTime=eb;this._lastUpdate=eb;this._lastPull=eb;this._lastInsert=eb;this._lastCustomStory=0;this._pollOnly=false;this._needNonCustomStoryNum=0;this._doCustomUpdate=true;this._autoloadStoryIndex=1;this._scrollTopThreshold=100;this._scrollTopPrompt=r.find(this._root,'.scrollTopPrompt');this._scrollTopPromptVisible=false;this._maxStoriesToKeep=50;this._minStoriesToKeep=25;this._tickerInSidebarMode=!!z.byClass(this._root,'fbChatSidebar');this._loadStoriesWithActions();ma('ticker_flyout');ma('ticker_flyout_prefetch');ma('ticker_flyout_loadtime');ma('ticker_stream');this._ua={flyout:va('ticker').uai('flyout','flyout',false),flyout_prefetch:va('ticker').uai('flyout_prefetch','flyout_prefetch',false),flyout_loadtime:va('ticker').uai('ticker_flyout_loadtime','flyout_loadtime',false),stream:va('ticker').uai('ticker_stream','stream',false)};this._uaCurStoryIDFetch=null;this._uaCurStoryIDPrefetch=null;var fb=r.create('div',{className:'storyQueue hidden_elem'});this._storyQueue=fb;r.appendContent(this._root,fb);this._initObjectIDs();this._initConfig(db);this._resetMorePager();this._initListeners();this._initSubscriptions(db);this._getAllStories().forEach(function(hb){this._centerStory(hb);this._addPresenceToStory(hb);}.bind(this));var gb=this._getAllStories();if(gb[0])q.addClass(gb[0],"_4-q6");i.inform('ticker/init',this,i.BEHAVIOR_PERSISTENT);this._poll();if(this._prefetchAfterLoad){this._logUserEvent('stream','prefetch');this._fetchStories(this._getInsertedStories().slice(0,5));}this._isHidden=true;this._resize();s.listen(window,'resize',ua(this._resize.bind(this)));},_resize:function(){var cb=ka.getViewportDimensions(),db=(cb.x>=this._minWidthRequired)&&(cb.y>=this._minHeightRequired);if(!this._isHidden&&!db){this._deactivateStory();this._isHidden=true;}else if(this._isHidden&&db)this._isHidden=false;},_centerStory:function(cb){var db=g.div({className:"_511a"},g.div({className:"_4-q8"}),r.find(cb,'.tickerStoryBlock'));r.appendContent(cb,db);},_addPresenceToStory:function(cb){var db=cb.getAttribute('data-actor');if(!db)return;var eb=l.get(db);if(eb!==m.MOBILE&&eb!==m.ACTIVE)return;var fb=g.i({className:"_4-q9"});if(eb===m.MOBILE){q.addClass(fb,"_4-qa");}else if(eb===m.ACTIVE)q.addClass(fb,"_4-qb");var gb=g.div({className:"_511b"},fb);r.prependContent(cb,gb);},_presenceChanged:function(){var cb=r.scry(this._stories,"._4-q6")[0];if(!cb)return;var db=r.scry(cb,"._511b")[0];db&&r.remove(db);this._addPresenceToStory(cb);},_loadStoriesWithActions:function(){var cb=sa('rightCol');if(!cb)return;this._toggleWrapper=r.scry(cb,'.tickerToggleWrapper')[0];if(this._toggleWrapper){var db=r.scry(this._stories,'.tickerStoryWithButton');this._storiesWithActions={};for(var eb=0;eb<db.length;eb++){var fb=db[eb];this._storiesWithActions[fb.getAttribute('data-story-key')]=fb;}}},_initConfig:function(cb){oa(this,{_newest:cb.newest,_page_newest:cb.newest,_timeout:cb.timeout,_heartbeatTimeout:Math.min(5000,cb.heartbeatTimeout),_maxHeartbeatTimeout:Math.max(30000,cb.maxHeartbeatTimeout),_pullTimeout:Math.max(30000,cb.pullTimeout),_insertTimeout:cb.insertTimeout,_friendCount:cb.friendCount,_maxQueueLength:cb.maxQueueLength,_heartbeatEndpoint:cb.heartbeatEndpoint,_noPoll:cb.nopoll,_maxCustomQueueLength:cb.maxCustomQueueLength,_customStoryInsertTimeout:Math.max(5000,cb.customStoryInsertTimeout),_nonCustomToCustomStoryRatio:cb.nonCustomToCustomStoryRatio,_minForceUpdateInterval:Math.max(cb.insertTimeout,cb.minForceUpdateInterval),_popupOnHover:cb.popupOnHover,_priorityAppId:cb.priorityAppId,_prefetchOnHover:cb.prefetchStoriesOnHover,_userIdleTimeout:cb.userIdleTimeout,_firstCustomStoryDelay:cb.firstCustomStoryDelay,_pollOnly:cb.pollOnly,_tickerSource:cb.tickerSource,_prefetchAfterLoad:cb.prefetchAfterLoad,_logFlyouts:cb.logFlyouts,_userScrollGaurdDelay:cb.userScrollGaurdDelay,_aggressiveRegulator:cb.aggressiveRegulator,_minHeightRequired:cb.minHeightRequired,_minWidthRequired:w.min_collapse_width});this._queueCustomStories(cb.customStories);},_initListeners:function(){this._listeners=s.listen(this._root,{click:this._handleClick.bind(this),keydown:this._handleKeydown.bind(this),mouseout:this._handleMouseout.bind(this),mouseover:this._handleMouseover.bind(this),mousedown:this._tickerDeClicker.bind(this),mouseup:this._handleMouseup.bind(this)});},_initSubscriptions:function(cb){aa.onLeave(this._cleanup.bind(this));this._subscriptions=[i.subscribe(y.NAVIGATION_BEGIN,this._onNavHandler.bind(this)),i.subscribe('composer/publish',this._handleComposerPublish.bind(this)),i.subscribe('Ticker/storiesInserted',this._handleStoriesInserted.bind(this)),i.subscribe('Ticker/fixed',this._setFixed.bind(this,true)),i.subscribe('Ticker/unfixed',this._setFixed.bind(this,false)),i.subscribe('ufi/comment',this._scrollDialogToBottom.bind(this)),i.subscribe('Ticker/chatOpened',this._handleChatOpened.bind(this)),i.subscribe(m.ON_AVAILABILITY_CHANGED,this._presenceChanged.bind(this))];if(!cb.pollOnly)this._subscriptions.push(i.subscribe(o.getArbiterType('ticker_update'),this._handleTickerPush.bind(this)));if(cb.pushChannel&&!cb.pollOnly)this.setPushChannel(cb.pushChannel);},_handleClick:function(event){var cb=event.getTarget();if(this._getButtonFromNode(cb)){this._logUserAction(cb,'click',event);this._handleActionButton(event);return;}var db=this._getStoryFromNode(cb),eb=z.byClass(cb,'tickerStoryAllowClick');if(!db||db==this._selectedStory||eb)return;if(this._storyIsHidden(db))return;if(db==this._activeStory&&!this._selectedStory)this._selecting=true;this._clearNux();this._logUserEvent('flyout','click');this._logUserEvent('flyout_loadtime','open');if(this._storyCanOpenExternally(db)){var fb=db.getAttribute('data-href');if(fb&&!cb.getAttribute('href')){var gb={href:fb},hb=na(cb,['ft','gt']);ma('click',gb,event,'FORCE',hb);va('ticker',gb,event).uai('click');}else this._logUserAction(cb,'click',event);this._openStoryExternally(db,event);return;}this._logUserAction(cb,'flyout',event);this._activateStory(db,'click');this._selectStory(db);},_handleMouseover:function(event){this._setLocked(true);var cb=event.getTarget(),db=this._getOpenableStory(cb);if(!db)return;event.kill();if(this._prefetchOnHover||this._popupOnHover){if(!(db.id in this._fetchedStories)){this._logUserEvent('flyout_prefetch','prefetch_on_hover');this._uaCurStoryIDPrefetch=db.id;}this._fetchStory(db);}if(this._selectedStory)return;if(this._popupOnHover){this._clearHoverTimeouts();var eb=this._storyCanOpenExternally(db)?500:1000,fb=this._activeStory?75:eb;this._hoverShowTimeout=this._setTimeout(function(){this._logUserEvent('flyout','hover',fb);this._logUserEvent('flyout_loadtime','open');this._activateStory(db,'hover');this._logUserAction(cb,'flyout',event);}.bind(this),fb);}},_handleMouseout:function(event){var cb=event.getTarget();this._setLocked(false);if(cb==this._getStoryFromNode(cb)){var db=r.scry(cb.parentNode,'.openToggler');for(var eb=0;eb<db.length;eb++)ca.toggle(db[eb]);}this._clearClickedStory();this._scheduleHide();},_handleKeydown:function(event){this._tickerDeClicker(event);var cb=this._activeStory;if(!cb)return;var db=s.getKeyCode(event);if(db===u.ESC)this._deactivateStory(true);},_fadeTopmostStoryButton:function(){var cb=0,db=15;if(this._storiesWithActions)for(var eb in this._storiesWithActions){var fb=this._storiesWithActions[eb],gb=r.scry(fb,'.tickerInlineActionButton')[0],hb=r.scry(gb,'.tickerActionIcon')[0],ib=ka.getElementPosition(gb).y-ka.getElementPosition(this._toggleWrapper).y;if(ib<cb){da.set(gb,'opacity',0);da.set(hb,'opacity',0);}else if(ib>=cb&&ib<db){var jb=(ib-cb)/(db-cb);da.set(gb,'opacity',jb);da.set(hb,'opacity',jb);break;}else{da.set(gb,'opacity',1);da.set(hb,'opacity',1);}}},_handleStoriesInserted:function(){this._logUserEvent('stream','insert');},_handleActionButton:function(event){var cb=event.getTarget(),db=this._getOpenableStory(cb),eb=this._getStoryDialog(db);if(eb)var fb=eb.subscribe('beforehide',function(){eb.unsubscribe(fb);return false;});},_clearHoverTimeouts:function(){clearTimeout(this._hoverShowTimeout);clearTimeout(this._hoverHideTimeout);},_getAllStories:function(){return r.scry(this._root,'div.fbFeedTickerStory');},_getInsertedStories:function(){return this._getAllStories().filter(function(cb){return !q.hasClass(cb,'queuedStory')&&!q.hasClass(cb,'customStory');});},_getQueuedStories:function(){return r.scry(this._storyQueue,'.fbFeedTickerStory.queuedStory');},_getQueuedCustomStories:function(){return r.scry(this._storyQueue,'.fbFeedTickerStory.customStory');},_getButtonFromNode:function(cb){return z.byClass(cb,'tickerInlineOverlay');},_getStoryFromNode:function(cb){return z.byClass(cb,'fbFeedTickerStory');},_getActionButtonFromStory:function(cb){return r.scry(cb,'.tickerInlineActionButton')[0];},_getOpenableStory:function(cb){var db=this._getStoryFromNode(cb);return this._storyCanOpenDialog(db)?db:null;},_getStoryDialog:function(cb){return p.getInstance(cb);},_getStoryDialogEndpoint:function(cb){return cb&&cb.getAttribute('data-rel')=='async'&&cb.getAttribute('data-ajaxify')||null;},_storyCanOpenDialog:function(cb){return !!this._getStoryDialogEndpoint(cb)&&!this._storyIsHidden(cb);},_storyCanOpenExternally:function(cb){return !!cb.getAttribute('data-href')||!this._storyCanOpenDialog(cb);},_storyIsHidden:function(cb){return q.hasClass(cb,'tickerStoryHidden');},hideActiveStory:function(){this._activeStory&&this.hideStory(this._activeStory);},hideStory:function(cb){this._deactivateStory();if(r.getText(cb)==='')r.remove(cb);q.addClass(cb,'tickerStoryHidden');q.removeClass(cb,'tickerStoryClickable');},undoHideStory:function(cb){q.addClass(cb,'tickerStoryClickable');q.removeClass(cb,'tickerStoryHidden');},insertStoriesAtBottom:function(cb){if(!cb)return;var db=r.create('div');db.appendChild(cb);var eb=r.scry(db,'.fbFeedTickerStory'),fb=r.find(db,'.tickerMorePager'),gb=[];for(var hb=0;hb<eb.length;hb++)if(!this.dedupeStory(eb[hb]))gb.push(eb[hb]);if(gb.length){gb.push(fb);r.replace(r.find(this._root,'.tickerMorePager'),gb);}i.inform('Ticker/storiesInserted');},_scheduleHide:function(){if(this._popupOnHover&&!this._selectedStory){this._clearHoverTimeouts();this._hoverHideTimeout=this._setTimeout(this._deactivateStory.bind(this),100);}},_isUserIdle:function(){return !ia.isActive(this._userIdleTimeout);},_schedulePoll:function(){clearTimeout(this._pollToken);this._pollToken=this._setTimeout(this._poll.bind(this),this._timeout);},_poll:function(){if(!this._isTickerVisible())return;if(this._storiesToRemove.length>0){if(this._isInsertingStory)return this._schedulePoll();var cb=this._storiesToRemove.pop();this.removeStory(cb);}var db=Date.now(),eb=db-this._lastInsert;if(eb<this._insertTimeout||this._isLocked())return this._schedulePoll();var fb=this._getQueuedStories(),gb=this._getQueuedCustomStories(),hb=this._isUserIdle(),ib=fb.length>0,jb=gb.length>0&&!hb&&(db-this._initTime>this._firstCustomStoryDelay)&&(this._needNonCustomStoryNum===0||(!ib&&(db-this._lastCustomStory)>this._customStoryInsertTimeout));if(jb){this.insertStory(gb.shift());this._lastCustomStory=db;this._needNonCustomStoryNum=this._nonCustomToCustomStoryRatio;return this._schedulePoll();}if(ib){this.insertStory(fb.shift());this._needNonCustomStoryNum--;if(this._needNonCustomStoryNum<0)this._needNonCustomStoryNum=0;return this._schedulePoll();}if(hb)return ia.subscribeOnce(this._poll.bind(this));var kb=gb.length===0&&this._needNonCustomStoryNum===0&&this._nonCustomToCustomStoryRatio>0&&ia.isActive(this.ADS_IDLE_MS)&&((db-this._lastUpdate)>this._minForceUpdateInterval),lb=false,mb=false;if(this._pollOnly){mb=db-this._lastUpdate>this._heartbeatTimeout;}else lb=(db-this._lastPull>this._pullTimeout);var nb=(kb&&this._doCustomUpdate)||lb||mb;if(!nb)return this._schedulePoll();if(kb)this._doCustomUpdate=false;this.update({pull:lb,fullpoll:mb,needcustomstory:kb});},_updatePollOnlyHeartbeatTimeout:function(){if(this._pollOnly&&this._heartbeatTimeout<this._maxHeartbeatTimeout)this._heartbeatTimeout=Math.min(this._heartbeatTimeout+5000,this._maxHeartbeatTimeout);},update:function(cb){this._updatePollOnlyHeartbeatTimeout();if(this._noPoll&&!this._pollOnly)return this._schedulePoll();var db={newest:(cb.fullpoll||cb.cache_update)?this._newest:this._page_newest,storyids:this._storyIDs,friendcount:this._friendCount,priorityappid:this._priorityAppId,source:this._tickerSource,needcustomstory:this._nonCustomToCustomStoryRatio>0};oa(db,cb);new j().setURI(this._heartbeatEndpoint).setReadOnly(true).setOption('retries',0).setData(db).setHandler(this._handleResponse.bind(this)).setFinallyHandler(this._poll.bind(this)).setAllowCrossPageTransition(true).send();this._lastUpdate=Date.now();if(db.pull)this._lastPull=this._lastUpdate;this._storyIDs=[];},_updateCurrentStory:function(cb,db){q.addClass(cb,"_4-q6");var eb=r.scry(this._stories,"._4-q6")[0];if(!eb||db===false){r.prependContent(this._stories,cb);eb&&q.removeClass(eb,"_4-q6");}else{da.set(cb,'margin-top',-ab+'px');r.prependContent(this._stories,cb);new h(cb).to('marginTop',0).duration(300).ondone(function(){eb&&q.removeClass(eb,"_4-q6");}).go();}},insertStory:function(cb,db,eb){this._lastInsert=Date.now();window.LiveTimer&&x.addTimeStamps(cb);q.removeClass(cb,'queuedStory');q.removeClass(cb,'customStory');if(db!==false){this._updateCurrentStory(cb,true);}else this._updateCurrentStory(cb);this._centerStory(cb);this._addPresenceToStory(cb);if(this._storiesWithActions&&q.hasClass(cb,'tickerStoryWithButton'))this._storiesWithActions[cb.getAttribute('data-story-key')]=cb;this._removeOldStories();},_removeOldStories:function(){var cb=this._getInsertedStories();if(cb.length<=this._maxStoriesToKeep)return;var db=this._minStoriesToKeep,eb=cb.slice(db);eb.forEach(r.remove);if(this._storiesWithActions)for(var fb=0;fb<eb.length;fb++)delete this._storiesWithActions[eb[fb].getAttribute('data-story-key')];this._resetMorePager();},_resetMorePager:function(){var cb=this._getInsertedStories();if(!cb||!cb.length)return;var db=cb[cb.length-1].getAttribute('data-ticker-timestamp'),eb=r.scry(this._root,'.tickerMorePager a')[0];if(!eb||!db)return;var fb=new ha(eb.getAttribute('ajaxify'));fb.addQueryData({oldest:db});eb.setAttribute('ajaxify',fb);},_setLocked:function(cb){this._locked=cb;},_isLocked:function(){return !!(this._locked||this._activeStory);},informAndRemoveStory:function(cb,db,eb){var fb=this._getStoryFromNode(cb),gb=fb.getAttribute('data-story-key');r.setContent(fb,db);q.addClass(fb,'highlightedStory');this._setTimeout(this.removeStory.bind(this,gb),eb||6000);},_getStoryByStoryKey:function(cb){var db=this._getAllStories();for(var eb=0;eb<db.length;eb++){var fb=db[eb];if(fb.getAttribute('data-story-key')==cb)return fb;}return null;},removeStory:function(cb){this._removedStoryIDs[cb]=true;var db=this._getStoryByStoryKey(cb);if(!db)return;if(this._storiesWithActions)delete this._storiesWithActions[cb];if(db==this._activeStory)this._deactivateStory();var eb=this._getStoryDialog(db);eb&&eb.destroy();if(q.hasClass(db,'queuedStory')){r.remove(db);return;}this._animateStoryOut(db);},_flyStoryIn:function(cb){var db=r.create('div',{style:{marginTop:'-1000px'}},cb);da.set(db,'opacity',0);r.prependContent(this._stories,db);var eb=ka.getElementDimensions(db).y;da.set(db,'marginTop','-'+eb+'px');this._isInsertingStory=true;new h(db).to('marginTop',0).ease(h.ease.end).checkpoint(.5).to('opacity',1).ondone(function(){r.replace(db,cb);this._afterInsert(cb);this._isInsertingStory=false;}.bind(this)).go();},_fadeStoryIn:function(cb,db){new h(this._stories).to('opacity',.5).ondone(function(){r.prependContent(this._stories,cb);if(db)db();new h(this._stories).to('opacity',1).ondone(function(){this._afterInsert(cb);}.bind(this)).go();}.bind(this)).go();},_animateStoryOut:function(cb){var db=r.create('div',{style:{overflow:'hidden',position:'relative'}});r.insertBefore(cb,db);r.appendContent(db,cb);new h(db).to('top',20).to('height',0).to('opacity',0).ease(h.ease.end).ondone(function(){r.remove.bind(null,db);i.inform('Ticker/animateOut');}.bind(this)).go();},_afterInsert:function(cb){i.inform('Ticker/afterInsert');},setPushChannel:function(cb){this._pushSubscription&&this._pushSubscription.unsubscribe();this._pushSubscription=i.subscribe(o.getArbiterType(cb),this._handleTickerPush.bind(this));d(['ChatConfig','ChannelConnection'],function(db,eb){this._channelConnection=eb;this._checkChannelConnection();this._channelConnectionSubscription=this._channelConnection.subscribe([this._channelConnection.CONNECTED,this._channelConnection.RECONNECTING,this._channelConnection.SHUTDOWN,this._channelConnection.MUTE_WARNING,this._channelConnection.UNMUTE_WARNING],this._handleChannelConnection.bind(this));}.bind(this));},_checkChannelConnection:function(){q.conditionClass(this._root,'disconnected',this._channelConnection.disconnected());},setCurrentAppId:function(cb){this._priorityAppId=cb;},_handleTickerPush:function(cb,db){var eb=db.obj;if(eb.delete_id){this._storiesToRemove.push(eb.delete_id);return;}if(eb.fromups)if(eb.do_logging)this._logDarkLaunch(eb);var fb=eb.story_xhp;if(!fb)return;this._newest=eb.story_time;var gb=t(fb).getRootNode();gb.setAttribute('data-actor',eb.actor);this.queueStory(gb,eb.flyout_js_cmds);if(this._aggressiveRegulator&&eb.actor==this._newestStory.actorID){this.removeStory(this._newestStory.storyKey);new k('/common/ods_endpoint.php',{k:'ticker.aggr.remove'}).send();}this._newestStory={actorID:eb.actor,storyKey:gb.getAttribute('data-story-key')};},_handleComposerPublish:function(cb,db){db.tickerMarkup&&this.insertStory(db.tickerMarkup);},_clearNux:function(){var cb=r.scry(document.body,'div.tickerNUXContainer');if(cb.length){cb.forEach(function(db){var eb=p.getInstance(db);eb&&eb.hide();});new j().setURI('/ajax/feed/ticker/nux.php').send();}this._clearNux=ra;},_logDarkLaunch:function(cb){var db={actor:cb.actor,story_time:cb.story_time,key:cb.story_obj_id,dark:1};new j().setURI('/alite/push/log.php').setData({msg:JSON.stringify(db)}).send();},_logRender:function(){if(this._loggedRender)return;var cb=this._tickerInSidebarMode;if(cb||z.byClass(this._content,'home_right_column')){new k('/ajax/log_ticker_render.php',{sidebar_mode:cb}).send();this._loggedRender=true;}},_isTickerVisible:function(){var cb=(bb._activeInstance==this);cb&&this._logRender();return cb;},_handleResponse:function(cb){var db=cb.getPayload();if(db.newest)this._newest=this._page_newest=db.newest;if(db.content)if(db.content instanceof Array){for(var eb=0;eb<db.content.length;eb++)this.queueStoryMarkup(db.content[eb]);}else this.queueStoryMarkup(db.content);if(db.custom_stories&&db.custom_stories.length){this._queueCustomStories(db.custom_stories);this._doCustomUpdate=true;}},queueStoryMarkup:function(cb){var db=t(cb).getRootNode();this.queueStory(db);},dedupeStory:function(cb){var db=cb.getAttribute('data-story-key'),eb=db&&(!!this._objectIDs[db]||!!this._removedStoryIDs[db]);db&&(this._objectIDs[db]=true);return eb;},queueStory:function(cb,db){if(this.dedupeStory(cb))return;q.addClass(cb,'queuedStory');r.appendContent(this._storyQueue,cb);var eb=db&&db.length;if(eb)db.forEach(function(gb){new Function(gb).apply();});cb.setAttribute('id',cb.id+'_'+this._root.id);var fb=this._getQueuedStories();fb.slice(0,-this._maxQueueLength).forEach(r.remove);if(eb)this._fetchedStories[cb.id]=true;},_queueCustomStories:function(cb){while(cb.length){var db=cb.shift();db=t(db).getRootNode();if(this.dedupeStory(db))continue;q.addClass(db,'customStory');r.appendContent(this._storyQueue,db);}var eb=this._getQueuedCustomStories();eb.slice(0,-this._maxQueueLength).forEach(r.remove);},_cleanup:function(){bb._placeholders.pagelet_rhc_ticker=null;if(!z.byClass(this._content,'hasRightCol'))return;this._objectIDs=[];this._subscriptions.forEach(i.unsubscribe);this._channelConnectionSubscription&&this._channelConnection.unsubscribe(this._channelConnectionSubscription);this._pushSubscription&&this._pushSubscription.unsubscribe();for(var cb in this._listeners)this._listeners[cb]&&this._listeners[cb].remove();clearTimeout(this._pollToken);this._pollToken=null;this._cleanupInputFocusListener();this._cleanupContentResizeListener();i.inform('Ticker/cleanup');},_onNavHandler:function(cb,db){var eb=db.params.key;if(eb!='lf'&&eb!='h')this._cleanup();},registerStoryDialog:function(cb,db){if(this._uaCurStoryIDFetch==cb.id){this._uaCurStoryIDFetch=null;this._logUserEvent('flyout','fetch_success');}if(this._uaCurStoryIDPrefetch==cb.id){this._uaCurStoryIDPrefetch=null;this._logUserEvent('flyout_prefetch','prefetch_success');}this._fetchedStories[cb.id]=true;db.setContext(cb);db.subscribe('hide',this._deactivateStory.bind(this,true));db.subscribe('success',this._focusStory.bind(this,cb));db.subscribe('beforehide',function(){if(this._selecting){this._selecting=false;return false;}}.bind(this));if(this._popupOnHover){db.subscribe('mouseenter',this._clearHoverTimeouts.bind(this));db.subscribe('mouseleave',this._scheduleHide.bind(this));db.subscribe('show',function(){var eb=s.listen(db.getContent(),'mousedown',function(){this._selectStory(cb);eb.remove();}.bind(this));}.bind(this));}if(cb==this._activeStory){this._logUserEvent('flyout_loadtime','show_fetched');this._logUserEvent('flyout','show');this._openDialog(db);}},_openStoryExternally:function(cb,event){var db=cb.getAttribute('data-href');if(!db||db=='#')return;var eb=cb.getAttribute('data-story-rel');switch(eb){case 'theater':this._deactivateAndClearStory();n.loadModules(["PhotoViewer"],function(hb){hb.bootstrap(db,cb);});return;case 'async':this._deactivateAndClearStory();j.bootstrap(db,cb);return;}var fb=cb.getAttribute('data-target'),gb=(event.which!=1||event.getModifiers().any||fb=='_blank');gb?window.open(db,'_blank'):ta(db);},_deactivateAndClearStory:function(){this._clearHoverTimeouts();this._deactivateStory();},_focusStory:function(cb){cb.focus();},_selectStory:function(cb){this._selectedStory=cb;q.addClass(cb,'tickerStorySelected');q.addClass(this._root,'tickerChildSelected');},_activateStory:function(cb,db){this._clearHoverTimeouts();if(cb==this._activeStory||!this._storyCanOpenDialog(cb))return;this._deactivateStory();this._focusStory(cb);this._activeStory=cb;q.addClass(cb,'tickerStoryActive');window.Toggler&&fa.hide();if(this._logFlyouts){db=db||'unknown';new k('/ajax/feed/ticker/flyout.php',{src:db}).send();}ea.log(cb);var eb=this._getStoryDialog(cb);if(eb){this._logUserEvent('flyout_loadtime','show_prefetched');this._logUserEvent('flyout','show');this._openDialog(eb);return;}if(!(cb.id in this._fetchedStories)){this._uaCurStoryIDFetch=cb.id;this._logUserEvent('flyout','fetch');}this._fetchStory(cb);},_deactivateStory:function(cb){if(this._activeStory===this._deactivatingStory)return;this._deactivatingStory=this._activeStory;if(this._dialog){if(cb===true){this._dialog.enableBehavior(v);}else this._dialog.disableBehavior(v);this._dialog.hide();this._logUserEvent('flyout','close');}if(this._activeStory){q.removeClass(this._activeStory,'tickerStoryActive');q.removeClass(this._activeStory,'tickerStorySelected');q.removeClass(this._root,'tickerChildSelected');}this._dialog=this._selectedStory=this._activeStory=null;this._cleanupInputFocusListener();this._cleanupContentResizeListener();this._deactivatingStory=null;},_logUserAction:function(cb,db,event){ma(db,cb,event,'FORCE');va('ticker',cb,event).uai(db);},_logUserEvent:function(cb,event){if(this._ua[cb])this._ua[cb].add_event(event);},_fetchStory:function(cb){clearTimeout(this._fetchToken);var db=[],eb=this._getInsertedStories(),fb=eb.indexOf(cb);[-1,0,1].forEach(function(gb){var hb=eb[fb+gb];hb&&db.push(hb);},this);this._fetchToken=setTimeout(this._fetchStories.bind(this,db),100);},_fetchStories:function(cb){var db=[],eb,fb=function(gb){clearTimeout(eb);cb.forEach(function(hb){q.conditionClass(hb,'tickerStoryFetching',gb);});};cb=cb.filter(function(gb){if(gb.id in this._fetchedStories)return false;this._fetchedStories[gb.id]=true;var hb=this._getStoryDialogEndpoint(gb),ib=ha(hb).getQueryData();if(!hb||!ib)return false;ib.uniq_id=gb.getAttribute('id');ib.referrer=this._tickerSource;db.push(ib);return true;},this);if(!db.length)return;eb=this._setTimeout(fb.bind(null,true),500);new j('/ajax/feed/ticker/multi_story').setFinallyHandler(fb.bind(null,false)).setErrorHandler(ra).setData({stories:db}).setAllowCrossPageTransition(this._tickerInSidebarMode).send();},_tickerDeClicker:function(event){var cb=event.getTarget(),db=z.byTag(cb,'a'),eb=this._getStoryFromNode(cb),fb=this._getButtonFromNode(cb);if(eb&&db&&!fb&&q.hasClass(eb,'tickerStoryClickable')&&!q.hasClass(db,'tickerStoryAllowClick')&&!this._storyIsHidden(eb)){db.setAttribute('rel','ignore');db.removeAttribute('onclick');db.removeAttribute('ajaxify');db.removeAttribute('href');}var gb=(event.button==2),hb=(event.type==='keydown'),ib=eb&&this._getActionButtonFromStory(eb);if(!gb&&ib&&!hb)this._setClickedStory(eb);},_handleMouseup:function(event){this._clearClickedStory();},_setClickedStory:function(cb){this._clearClickedStory();q.addClass(cb,'tickerStoryClicked');this._clickedStory=cb;},_clearClickedStory:function(){if(this._clickedStory){q.removeClass(this._clickedStory,'tickerStoryClicked');this._clickedStory=null;}},_setFixed:function(cb){if(!this._selectedStory)return;var db=this._getStoryDialog(this._selectedStory);if(db){db.setFixed(cb);db.updatePosition();}},_setTimeout:function(cb,db){return setTimeout(cb,db,!this._tickerInSidebarMode);},_scrollDialogToBottom:function(){var cb=this._dialog&&this._dialog.getContent(),db=cb&&r.scry(cb,'.uiScrollableAreaWrap')[0],eb=db&&ba.getInstance(db);eb&&eb.scrollToBottom();},_openDialog:function(cb){if(!this._tickerInSidebarMode)q.addClass(cb.getRoot(),'tickerStoryOverlayOnTop');this._dialog=cb.show();this._updateDialogPosition();this._writeSwfFrame(cb);setTimeout(this._initCommentFocusListener.bind(this),0);setTimeout(this._initContentResizeListener.bind(this),0);this._stupidIE7VideoResizeHack(cb);},_stupidIE7VideoResizeHack:function(cb){if(ja.ie()===7){var db=r.scry(cb.getContent(),'.uiVideoThumb .img');db.forEach(function(eb){da.set(eb,'width','');});}},_updateDialogPosition:function(){var cb=this._tickerInSidebarMode||!!z.byClass(this._root,'fixed_elem');this._dialog.setFixed(cb);this._adjustFlyoutContentHeight();this._dialog.updatePosition();},_writeSwfFrame:function(cb){var db=this._dialog&&this._dialog.getContent(),eb=r.scry(db,'.swfObject')[0];if(!eb)return;var fb=eb.getAttribute('data-swfid');if(fb&&window[fb]){var gb=window[fb];gb.write(eb);}},_initCommentFocusListener:function(){var cb=this._dialog&&this._dialog.getContent(),db=cb&&r.scry(cb,'.tickerDialogFooter textarea')[0];if(!db)return;this._listeners.inputFocus=s.listen(db,'focus',this._scrollDialogToBottom.bind(this));},_cleanupInputFocusListener:function(){if(this._listeners.inputFocus){this._listeners.inputFocus.remove();this._listeners.inputFocus=null;}},_initContentResizeListener:function(){var cb=this._dialog&&this._dialog.getContent();if(!cb)return;this._listeners.contentResize=s.listen(cb,'click',function(){setTimeout(this._dialog.updatePosition.bind(this._dialog),0);}.bind(this));},_cleanupContentResizeListener:function(){if(this._listeners.contentResize){this._listeners.contentResize.remove();this._listeners.contentResize=null;}},_adjustFlyoutContentHeight:function(){var cb=this._dialog&&this._dialog.getContent(),db=cb&&r.scry(cb,'.uiScrollableAreaWrap')[0];if(!db)return;var eb=ka.getElementDimensions(db),fb=ka.getElementPosition(db),gb=r.scry(db,'.uiUfi .uiUfiComment'),hb=ka.getViewportDimensions().y-this.FLYOUT_VIEWPORT_PADDING,ib=Math.min(this.FLYOUT_MAX_HEIGHT,hb),jb=ib-this.FLYOUT_TARGET_HEIGHT_OFFSET;for(var kb=0;kb<gb.length;kb++){var lb=gb[kb],mb=ka.getElementPosition(lb),nb=mb.y-fb.y;if(Math.abs(nb-jb)<=this.FLYOUT_OFFSET_THRESHOLD){jb=nb+this.FLYOUT_COMMENT_OFFSET;break;}}if(eb.y>jb){da.set(db,'height',jb+'px');da.set(db,'max-height',null);}else{da.set(db,'max-height',ib+'px');da.set(db,'height',null);}},_initObjectIDs:function(){var cb=this._getAllStories();for(var db=0;db<cb.length;++db){var eb=cb[db].getAttribute('data-story-key');eb&&(this._objectIDs[eb]=true);}},_handleChatOpened:function(){this._deactivateStory(true);},_handleChannelConnection:function(){this._checkChannelConnection();},getNewest:function(){return this._newest;}});e.exports=bb;});
__d("legacy:LitestandTickerController",["LitestandTickerController"],function(a,b,c,d){a.LitestandTickerController=b('LitestandTickerController');},3);